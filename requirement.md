## 項目名稱：AI 驅動的文本轉 Mermaid 圖表 Web 應用

### 🎯 項目目標

開發一款 Web 應用程序，利用 AI 技術將用户輸入或上傳的文本內容智能轉換為 Mermaid 格式的代碼，並將其渲染成可視化圖表展示給用户。

---

### ✨ 核心功能

1. **文本輸入與處理**:
    
    - **手動輸入**: 提供一個文本編輯區域，用户可以直接粘貼或輸入文本內容。
    - **文件上傳**:
        - 支持 `.txt`, `.md` (Markdown), `.docx` (Microsoft Word) 格式的文件。
        - 需要後端或前端處理文件解析，提取純文本內容。
    - **內容預處理**: （可選，但建議）對提取的文本進行初步清洗，去除不必要的特殊字符或格式，以便更好地被 AI 模型理解。
    - **字符數限制**:
        - 輸入文本（包括手動輸入和文件上傳解析後的文本）總長度上限為 20,000 字符。
        - 前端應有字數統計和超出提示。
        - 後端也應進行校驗，防止超長文本提交。
2. **AI 文本轉 Mermaid 代碼**:
    - **AI 模型接口**:
        - 通過 API 請求與 AI 模型進行交互。
        - 接口協議遵循 OpenAI 兼容模式。
    - **核心轉換邏輯**: 將預處理後的文本發送給 AI 模型，AI 模型分析文本內容並生成相應的 Mermaid 代碼。
    - **Prompt 設計**: 需要精心設計 Prompt，引導 AI 模型準確理解文本內容並生成正確的 Mermaid 語法。可以考慮支持不同圖表類型的生成（例如流程圖、序列圖、甘特圖等），用户或許可以選擇期望的圖表類型。
3. **Mermaid 代碼編輯與渲染**:
    - **Mermaid 代碼展示**: 在一個區域清晰展示 AI 生成的 Mermaid 代碼。
    - **代碼編輯**: （建議）允許用户對 AI 生成的 Mermaid 代碼進行手動修改和優化。
    - **實時渲染**:
        - 使用 **Excalidraw** 作為基礎繪圖工具。
        - 集成 **mermaid-to-excalidraw** 庫，將 Mermaid 代碼轉換為 Excalidraw 的元素進行渲染。
        - 當 Mermaid 代碼發生變化時（無論是 AI 生成還是用户修改），圖表應能自動或手動觸發重新渲染。
    - **渲染結果交互**: 利用 Excalidraw 的特性，渲染出的圖表可能具備一定的交互能力（如拖拽、縮放等）。
4. **用户界面 (UI)**:
    - 清晰的佈局，將文本輸入區、Mermaid 代碼區、渲染結果區分開。
    - 直觀的操作按鈕，如“上傳文件”、“生成圖表”、“複製代碼”、“導出圖表”（若 Excalidraw 支持）。

---

### 🛠️ 技術棧

1. **前端框架**: **Next.js** (最新版本)
    - API Routes 可用於處理文件上傳或作為後端 AI 接口請求的代理。
2. **UI 組件庫**: **shadcn/ui**
    - 提供高質量、可定製的 UI 組件。
3. **CSS 框架**: **Tailwind CSS**
    - 用於快速構建現代化、響應式的用户界面。
4. **Mermaid 渲染器**:
    - **Excalidraw**: 作為核心的繪圖和展示畫布。
    - **mermaid-to-excalidraw**: 用於將 Mermaid 語法字符串轉換為 Excalidraw 場景數據。
    - **調研**: 務必查閲 `Excalidraw` 和 `mermaid-to-excalidraw` 的最新文檔，瞭解其 API、集成方式、功能限制以及可能的配置項。

---

### 🤖 AI 集成

1. **接口配置**:
    - **URL**: AI 接口的請求地址。
    - **Key**: API 訪問密鑰。
    - **Model**: 指定使用的 AI 模型名稱（如 `gpt-3.5-turbo`, `gpt-4` 等兼容模型）。
    - **環境變量**: 以上配置信息均通過**環境變量**進行管理 (`process.env.AI_API_URL`, `process.env.AI_API_KEY`, `process.env.AI_MODEL_NAME`)，確保安全性與靈活性。
2. **API 請求**:
    - 在後端（例如 Next.js API Routes）或前端（需注意 Key 的安全暴露問題，推薦後端代理）發起對 AI 接口的 HTTP 請求。
    - 請求體應包含用户文本和必要的 Prompt 指令。
    - 處理 API 的響應，提取生成的 Mermaid 代碼。
3. **錯誤處理**:
    - 妥善處理 AI 接口請求可能出現的錯誤（如網絡問題、API 限流、認證失敗、內容生成失敗等）。
    - 向用户提供友好的錯誤提示。

---

### 📄 輸入/輸出規範

1. **輸入**:
    - 用户直接輸入的純文本。
    - `.txt`, `.md`, `.docx` 文件，解析為純文本。
    - （可選）用户選擇期望生成的圖表類型。
2. **輸出**:
    - **Mermaid 代碼**: 由 AI 生成，可編輯。
    - **可視化圖表**: 由 Mermaid 代碼通過 Excalidraw 渲染得到。
    - （可選）允許用户複製代碼或導出渲染後的圖表（如 PNG, SVG，取決於 Excalidraw 的導出能力）。